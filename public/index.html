<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leaderboard</title>
  <style>
    :root {
      --bg1: #4f46e5;
      --bg2: #7c3aed;
      --glass: rgba(255,255,255,.12);
      --text: #fff;
      --muted: rgba(255,255,255,.6);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px;
      font-family: Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
    }
    .wrap { width: min(1000px, 95vw); }
    .bar {
      display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
      background: var(--glass); backdrop-filter: blur(8px);
      border-radius: 16px; padding: 14px 18px; margin-bottom: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.2);
    }
    select, .pill {
      background: rgba(255,255,255,.08); color: var(--text);
      border: 1px solid rgba(255,255,255,.15);
      border-radius: 10px; padding: 8px 10px; font-size: 14px;
    }
    .title { font-size: 40px; font-weight: 800; display:flex; gap:10px; align-items:center; }
    .card {
      background: var(--glass); backdrop-filter: blur(8px);
      border-radius: 16px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.2);
      min-height: 140px;
    }
    .error { color: #ffd1d1; font-weight: 600; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px; }
    th { text-align: left; color: var(--muted); font-weight: 600; }
    tbody tr + tr { border-top: 1px solid rgba(255,255,255,.08); }
    .right { text-align: right; }
    .muted { color: var(--muted); }
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <div class="title">üèÜ Leaderboard</div>

    <div class="bar">
      <div>Period:</div>
      <select id="period">
        <option value="month">Denna m√•nad</option>
        <option value="today">Idag</option>
      </select>

      <div>Sortera p√•:</div>
      <select id="metric">
        <option value="deals">Aff√§rer (deals)</option>
        <option value="commission">Commission</option>
      </select>

      <div>Visa topp:</div>
      <select id="size">
        <option>5</option><option selected>10</option><option>15</option><option>20</option>
      </select>

      <div class="pill" id="subtitle">Top 10 ‚Äì Aff√§rer (success)</div>
    </div>

    <div class="card" id="board"></div>
  </div>

  <script>
    const periodSel = document.getElementById('period');
    const metricSel = document.getElementById('metric');
    const sizeSel = document.getElementById('size');
    const board = document.getElementById('board');
    const subtitle = document.getElementById('subtitle');

    async function load() {
      board.innerHTML = '<div class="muted">Laddar‚Ä¶</div>';
      const period = periodSel.value;
      const metric = metricSel.value;
      const size = sizeSel.value;

      subtitle.textContent = `Top ${size} ‚Äì ${metric === 'deals' ? 'Aff√§rer (success)' : 'Commission'}`;

      try {
        const url = `/api/leaderboard?period=${encodeURIComponent(period)}&metric=${encodeURIComponent(metric)}&size=${encodeURIComponent(size)}`;
        const r = await fetch(url);
        if (!r.ok) throw new Error(`LB ${r.status}`);
        const data = await r.json();

        const rows = (data.leaderboard || []).map((r, idx) => `
          <tr>
            <td class="muted">${idx + 1}</td>
            <td>${r.user}</td>
            <td class="muted">${r.group || '-'}</td>
            <td class="right">${r.deals}</td>
            <td class="right">${(r.commission || 0).toLocaleString('sv-SE')} THB</td>
          </tr>
        `).join('');

        board.innerHTML = rows
          ? `<table>
               <thead>
                 <tr>
                   <th>#</th><th>Agent</th><th>Grupp</th>
                   <th class="right">Deals</th><th class="right">Commission</th>
                 </tr>
               </thead>
               <tbody>${rows}</tbody>
             </table>`
          : '<div class="muted">Inga aff√§rer i vald period.</div>';
      } catch (err) {
        console.error(err);
        board.innerHTML = `<div class="error">Fel: ${err.message || err}</div>`;
      }
    }

    periodSel.onchange = metricSel.onchange = sizeSel.onchange = load;
    load();
  </script>
</body>
</html>
